\hypertarget{i2c-th_8ino}{}\section{sketchbook/rmap/i2c-\/th/i2c-\/th.ino File Reference}
\label{i2c-th_8ino}\index{sketchbook/rmap/i2c-\/th/i2c-\/th.\+ino@{sketchbook/rmap/i2c-\/th/i2c-\/th.\+ino}}
{\ttfamily \#include $<$debug\+\_\+config.\+h$>$}\newline
{\ttfamily \#include \char`\"{}i2c-\/th.\+h\char`\"{}}\newline
Include dependency graph for i2c-\/th.ino\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{i2c-th_8ino__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{i2c-th_8ino_a31fa5c36fa17c66feec7a67b76c3e786}\label{i2c-th_8ino_a31fa5c36fa17c66feec7a67b76c3e786}} 
\#define \hyperlink{i2c-th_8ino_a31fa5c36fa17c66feec7a67b76c3e786}{S\+E\+R\+I\+A\+L\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}~\hyperlink{debug__config_8h_a0138759b880270bd48d1f329c5c0af4d}{I2\+C\+\_\+\+T\+H\+\_\+\+S\+E\+R\+I\+A\+L\+\_\+\+T\+R\+A\+C\+E\+\_\+\+L\+E\+V\+EL}
\begin{DoxyCompactList}\small\item\em Serial debug level for this sketch. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{i2c-th_8ino_a4fc01d736fe50cf5b977f755b675f11d}\label{i2c-th_8ino_a4fc01d736fe50cf5b977f755b675f11d}} 
void {\bfseries setup} ()
\item 
\mbox{\Hypertarget{i2c-th_8ino_afe461d27b9c48d5921c00d521181f12f}\label{i2c-th_8ino_afe461d27b9c48d5921c00d521181f12f}} 
void {\bfseries loop} ()
\item 
void \hyperlink{i2c-th_8ino_afb98a0f07c30784284f48271ffe02b97}{init\+\_\+power\+\_\+down} (uint32\+\_\+t $\ast$time\+\_\+ms, uint32\+\_\+t debouncing\+\_\+ms)
\begin{DoxyCompactList}\small\item\em Enter power down mode. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_a980e73df66b14b1190bc25da430a4f12}{init\+\_\+wdt} (uint8\+\_\+t wdt\+\_\+timer)
\begin{DoxyCompactList}\small\item\em Init watchdog. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_ad241cc00b1a92e6d85827df96778e442}{init\+\_\+buffers} ()
\begin{DoxyCompactList}\small\item\em Init buffers. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_ab4bf0a3d77da083f131d3fa35a37d2b1}{init\+\_\+tasks} ()
\begin{DoxyCompactList}\small\item\em Init tasks variable and state. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_ad8b80a0c08f928106018edd6ea435b95}{init\+\_\+pins} ()
\begin{DoxyCompactList}\small\item\em Init hardware pins. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_a2441543100bf8421f56edd622a2c1d9a}{init\+\_\+wire} ()
\begin{DoxyCompactList}\small\item\em Init wire (i2c) library and performs checks on the bus. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_a8eb9780a3438ec02c70314744f91f3c7}{init\+\_\+spi} ()
\begin{DoxyCompactList}\small\item\em Init S\+PI library. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_ab985cc69f5f573113405b4f118c96d33}{init\+\_\+rtc} ()
\begin{DoxyCompactList}\small\item\em Init R\+TC module. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_afceb890a6ab9be73cc5481369538c705}{init\+\_\+system} ()
\begin{DoxyCompactList}\small\item\em Init system. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_a65b2dadc0411e43874ec8ed7f73bc62a}{print\+\_\+configuration} ()
\begin{DoxyCompactList}\small\item\em Print current configuration. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_afa979a8cb238fe81bf20654dfd6096ef}{save\+\_\+configuration} (bool is\+\_\+default)
\begin{DoxyCompactList}\small\item\em Save configuration to E\+E\+P\+R\+OM. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_a32a64a2800c724fb28e10636f2ec20b9}{load\+\_\+configuration} ()
\begin{DoxyCompactList}\small\item\em Load configuration from E\+E\+P\+R\+OM. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_ac74850003fab6eb3269bfe043d0f939c}{init\+\_\+sensors} ()
\begin{DoxyCompactList}\small\item\em Create and setup sensors. \end{DoxyCompactList}\item 
\hyperlink{i2c-th_8ino_ab16889ae984b9b798989a0d239283cac}{I\+SR} (T\+I\+M\+E\+R1\+\_\+\+O\+V\+F\+\_\+vect)
\begin{DoxyCompactList}\small\item\em Timer1 overflow interrupts routine. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_ac816bd8aafe77e7a571574c8a26eead5}{i2c\+\_\+request\+\_\+interrupt\+\_\+handler} ()
\begin{DoxyCompactList}\small\item\em I2C request interrupt handler. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_a6e27532df66f6bf186654355def5c9af}{i2c\+\_\+receive\+\_\+interrupt\+\_\+handler} (int rx\+\_\+data\+\_\+length)
\begin{DoxyCompactList}\small\item\em I2C receive interrupt handler. \end{DoxyCompactList}\item 
bool \hyperlink{i2c-th_8ino_a1c5769e114267b210fb3812064d01dd0}{make\+\_\+observation\+\_\+from\+\_\+samples} (bool is\+\_\+force\+\_\+processing, \hyperlink{structsample__t}{sample\+\_\+t} $\ast$sample, \hyperlink{structobservation__t}{observation\+\_\+t} $\ast$observation)
\begin{DoxyCompactList}\small\item\em Processing the samples to calculate an observation when the number of the samples reaches the exact samples\+\_\+count value. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_aba0fc91d6c2829df00a9d5fe2b921c90}{samples\+\_\+processing} (bool is\+\_\+force\+\_\+processing)
\begin{DoxyCompactList}\small\item\em Main routine for processing the samples to calculate an observation. \end{DoxyCompactList}\item 
bool \hyperlink{i2c-th_8ino_ab301e4d552826ef91458f52963949a1d}{make\+\_\+value\+\_\+from\+\_\+samples\+\_\+and\+\_\+observations} (\hyperlink{structsample__t}{sample\+\_\+t} $\ast$sample, \hyperlink{structobservation__t}{observation\+\_\+t} $\ast$observation, volatile \hyperlink{structvalue__t}{value\+\_\+t} $\ast$value)
\begin{DoxyCompactList}\small\item\em Processing the observations to calculate a value for report when the number of the observations reaches the minimum value of S\+T\+A\+T\+I\+S\+T\+I\+C\+A\+L\+\_\+\+D\+A\+T\+A\+\_\+\+C\+O\+U\+NT. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_a4c8e037e3b3f4c043abf3de8cf57fe68}{observations\+\_\+processing} ()
\begin{DoxyCompactList}\small\item\em Main routine for processing the observations to calculate a value for report. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_ad3efe51e17cb8205a24267c2992a12d4}{sensors\+\_\+reading\+\_\+task} ()
\begin{DoxyCompactList}\small\item\em Sensors reading Task. Read data from sensors. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_a46696a96b3118b5d8900703c054166c8}{exchange\+\_\+buffers} ()
\begin{DoxyCompactList}\small\item\em Exchange reader and writer pointer to buffer. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_ae176339df7451dc03037f319710575aa}{reset\+\_\+samples\+\_\+buffer} ()
\begin{DoxyCompactList}\small\item\em Reset samples buffers to default value. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_adfc6b4ac31f79cb1c99dd2409f05f32d}{reset\+\_\+observations\+\_\+buffer} ()
\begin{DoxyCompactList}\small\item\em Reset observations buffers to default value. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_a42389aceb96a84573eb67e6d141cb594}{command\+\_\+task} ()
\begin{DoxyCompactList}\small\item\em Execute the command received on i2c bus by reading i2c received data buffer. \end{DoxyCompactList}\item 
void \hyperlink{i2c-th_8ino_a4981066e183f1432ffd6eddf55826585}{commands} ()
\begin{DoxyCompactList}\small\item\em Performs specific operations based on the received command. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{i2c-th_8ino_a42389aceb96a84573eb67e6d141cb594}\label{i2c-th_8ino_a42389aceb96a84573eb67e6d141cb594}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!command\+\_\+task@{command\+\_\+task}}
\index{command\+\_\+task@{command\+\_\+task}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{command\+\_\+task()}{command\_task()}}
{\footnotesize\ttfamily void command\+\_\+task (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Execute the command received on i2c bus by reading i2c received data buffer. 

Command Task. Execute the command received on i2c bus by reading i2c received data buffer.

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c-th_8ino_a4981066e183f1432ffd6eddf55826585}\label{i2c-th_8ino_a4981066e183f1432ffd6eddf55826585}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!commands@{commands}}
\index{commands@{commands}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{commands()}{commands()}}
{\footnotesize\ttfamily void commands (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Performs specific operations based on the received command. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
C\+O\+N\+T\+I\+N\+U\+O\+US S\+T\+A\+RT

C\+O\+N\+T\+I\+N\+U\+O\+US S\+T\+OP

C\+O\+N\+T\+I\+N\+U\+O\+US S\+T\+A\+R\+T-\/\+S\+T\+OP

O\+N\+E\+S\+H\+OT S\+T\+A\+RT

O\+N\+E\+S\+H\+OT S\+T\+OP

O\+N\+E\+S\+H\+OT S\+T\+A\+R\+T-\/\+S\+T\+OP \mbox{\Hypertarget{i2c-th_8ino_a46696a96b3118b5d8900703c054166c8}\label{i2c-th_8ino_a46696a96b3118b5d8900703c054166c8}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!exchange\+\_\+buffers@{exchange\+\_\+buffers}}
\index{exchange\+\_\+buffers@{exchange\+\_\+buffers}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{exchange\+\_\+buffers()}{exchange\_buffers()}}
{\footnotesize\ttfamily void exchange\+\_\+buffers (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Exchange reader and writer pointer to buffer. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c-th_8ino_a6e27532df66f6bf186654355def5c9af}\label{i2c-th_8ino_a6e27532df66f6bf186654355def5c9af}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!i2c\+\_\+receive\+\_\+interrupt\+\_\+handler@{i2c\+\_\+receive\+\_\+interrupt\+\_\+handler}}
\index{i2c\+\_\+receive\+\_\+interrupt\+\_\+handler@{i2c\+\_\+receive\+\_\+interrupt\+\_\+handler}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{i2c\+\_\+receive\+\_\+interrupt\+\_\+handler()}{i2c\_receive\_interrupt\_handler()}}
{\footnotesize\ttfamily void i2c\+\_\+receive\+\_\+interrupt\+\_\+handler (\begin{DoxyParamCaption}\item[{int}]{rx\+\_\+data\+\_\+length }\end{DoxyParamCaption})}



I2C receive interrupt handler. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em rx\+\_\+data\+\_\+length} & received data length in bytes. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
read rx\+\_\+data\+\_\+length bytes of data from i2c bus

it is a registers read?

offset in readable\+\_\+data\+\_\+read\+\_\+ptr buffer

length (in butes) of data to be read in readable\+\_\+data\+\_\+read\+\_\+ptr

it is a command?

enable Command task

it is a registers write? \mbox{\Hypertarget{i2c-th_8ino_ac816bd8aafe77e7a571574c8a26eead5}\label{i2c-th_8ino_ac816bd8aafe77e7a571574c8a26eead5}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!i2c\+\_\+request\+\_\+interrupt\+\_\+handler@{i2c\+\_\+request\+\_\+interrupt\+\_\+handler}}
\index{i2c\+\_\+request\+\_\+interrupt\+\_\+handler@{i2c\+\_\+request\+\_\+interrupt\+\_\+handler}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{i2c\+\_\+request\+\_\+interrupt\+\_\+handler()}{i2c\_request\_interrupt\_handler()}}
{\footnotesize\ttfamily void i2c\+\_\+request\+\_\+interrupt\+\_\+handler (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



I2C request interrupt handler. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
write readable\+\_\+data\+\_\+length bytes of data stored in readable\+\_\+data\+\_\+read\+\_\+ptr (base) + readable\+\_\+data\+\_\+address (offset) on i2c bus \mbox{\Hypertarget{i2c-th_8ino_ad241cc00b1a92e6d85827df96778e442}\label{i2c-th_8ino_ad241cc00b1a92e6d85827df96778e442}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!init\+\_\+buffers@{init\+\_\+buffers}}
\index{init\+\_\+buffers@{init\+\_\+buffers}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{init\+\_\+buffers()}{init\_buffers()}}
{\footnotesize\ttfamily void init\+\_\+buffers (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Init buffers. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
copy readable\+\_\+data\+\_\+2 in readable\+\_\+data\+\_\+1 \mbox{\Hypertarget{i2c-th_8ino_ad8b80a0c08f928106018edd6ea435b95}\label{i2c-th_8ino_ad8b80a0c08f928106018edd6ea435b95}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!init\+\_\+pins@{init\+\_\+pins}}
\index{init\+\_\+pins@{init\+\_\+pins}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{init\+\_\+pins()}{init\_pins()}}
{\footnotesize\ttfamily void init\+\_\+pins (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Init hardware pins. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c-th_8ino_afb98a0f07c30784284f48271ffe02b97}\label{i2c-th_8ino_afb98a0f07c30784284f48271ffe02b97}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!init\+\_\+power\+\_\+down@{init\+\_\+power\+\_\+down}}
\index{init\+\_\+power\+\_\+down@{init\+\_\+power\+\_\+down}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{init\+\_\+power\+\_\+down()}{init\_power\_down()}}
{\footnotesize\ttfamily void init\+\_\+power\+\_\+down (\begin{DoxyParamCaption}\item[{uint32\+\_\+t $\ast$}]{time\+\_\+ms,  }\item[{uint32\+\_\+t}]{debouncing\+\_\+ms }\end{DoxyParamCaption})}



Enter power down mode. 


\begin{DoxyParams}{Parameters}
{\em time\+\_\+ms} & pointer to a variable to save the last instant you entered power down. \\
\hline
{\em debouncing\+\_\+ms} & delay to power down. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
turn off brown-\/out \mbox{\Hypertarget{i2c-th_8ino_ab985cc69f5f573113405b4f118c96d33}\label{i2c-th_8ino_ab985cc69f5f573113405b4f118c96d33}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!init\+\_\+rtc@{init\+\_\+rtc}}
\index{init\+\_\+rtc@{init\+\_\+rtc}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{init\+\_\+rtc()}{init\_rtc()}}
{\footnotesize\ttfamily void init\+\_\+rtc (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Init R\+TC module. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c-th_8ino_ac74850003fab6eb3269bfe043d0f939c}\label{i2c-th_8ino_ac74850003fab6eb3269bfe043d0f939c}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!init\+\_\+sensors@{init\+\_\+sensors}}
\index{init\+\_\+sensors@{init\+\_\+sensors}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{init\+\_\+sensors()}{init\_sensors()}}
{\footnotesize\ttfamily void init\+\_\+sensors (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Create and setup sensors. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c-th_8ino_a8eb9780a3438ec02c70314744f91f3c7}\label{i2c-th_8ino_a8eb9780a3438ec02c70314744f91f3c7}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!init\+\_\+spi@{init\+\_\+spi}}
\index{init\+\_\+spi@{init\+\_\+spi}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{init\+\_\+spi()}{init\_spi()}}
{\footnotesize\ttfamily void init\+\_\+spi (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Init S\+PI library. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c-th_8ino_afceb890a6ab9be73cc5481369538c705}\label{i2c-th_8ino_afceb890a6ab9be73cc5481369538c705}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!init\+\_\+system@{init\+\_\+system}}
\index{init\+\_\+system@{init\+\_\+system}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{init\+\_\+system()}{init\_system()}}
{\footnotesize\ttfamily void init\+\_\+system (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Init system. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
main loop state \mbox{\Hypertarget{i2c-th_8ino_ab4bf0a3d77da083f131d3fa35a37d2b1}\label{i2c-th_8ino_ab4bf0a3d77da083f131d3fa35a37d2b1}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!init\+\_\+tasks@{init\+\_\+tasks}}
\index{init\+\_\+tasks@{init\+\_\+tasks}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{init\+\_\+tasks()}{init\_tasks()}}
{\footnotesize\ttfamily void init\+\_\+tasks (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Init tasks variable and state. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
no tasks ready

reset samples\+\_\+count value \mbox{\Hypertarget{i2c-th_8ino_a980e73df66b14b1190bc25da430a4f12}\label{i2c-th_8ino_a980e73df66b14b1190bc25da430a4f12}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!init\+\_\+wdt@{init\+\_\+wdt}}
\index{init\+\_\+wdt@{init\+\_\+wdt}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{init\+\_\+wdt()}{init\_wdt()}}
{\footnotesize\ttfamily void init\+\_\+wdt (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{wdt\+\_\+timer }\end{DoxyParamCaption})}



Init watchdog. 


\begin{DoxyParams}{Parameters}
{\em wdt\+\_\+timer} & a time value for init watchdog (W\+D\+T\+O\+\_\+xxxx). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c-th_8ino_a2441543100bf8421f56edd622a2c1d9a}\label{i2c-th_8ino_a2441543100bf8421f56edd622a2c1d9a}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!init\+\_\+wire@{init\+\_\+wire}}
\index{init\+\_\+wire@{init\+\_\+wire}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{init\+\_\+wire()}{init\_wire()}}
{\footnotesize\ttfamily void init\+\_\+wire (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Init wire (i2c) library and performs checks on the bus. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
clear the I2C bus first before calling Wire.\+begin()

wait for watchdog reboot \mbox{\Hypertarget{i2c-th_8ino_ab16889ae984b9b798989a0d239283cac}\label{i2c-th_8ino_ab16889ae984b9b798989a0d239283cac}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!I\+SR@{I\+SR}}
\index{I\+SR@{I\+SR}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{I\+S\+R()}{ISR()}}
{\footnotesize\ttfamily I\+SR (\begin{DoxyParamCaption}\item[{T\+I\+M\+E\+R1\+\_\+\+O\+V\+F\+\_\+vect}]{ }\end{DoxyParamCaption})}



Timer1 overflow interrupts routine. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
Pre-\/load timer counter register

increment timer\+\_\+counter by T\+I\+M\+E\+R1\+\_\+\+I\+N\+T\+E\+R\+R\+U\+P\+T\+\_\+\+T\+I\+M\+E\+\_\+\+MS

check if S\+E\+N\+S\+O\+R\+S\+\_\+\+S\+A\+M\+P\+L\+E\+\_\+\+T\+I\+M\+E\+\_\+\+MS ms have passed since last time. if true and if is in continuous mode and continuous start command It has been received, activate Sensor reading task

reset timer\+\_\+counter if it has become larger than T\+I\+M\+E\+R1\+\_\+\+V\+A\+L\+U\+E\+\_\+\+M\+A\+X\+\_\+\+MS \mbox{\Hypertarget{i2c-th_8ino_a32a64a2800c724fb28e10636f2ec20b9}\label{i2c-th_8ino_a32a64a2800c724fb28e10636f2ec20b9}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!load\+\_\+configuration@{load\+\_\+configuration}}
\index{load\+\_\+configuration@{load\+\_\+configuration}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{load\+\_\+configuration()}{load\_configuration()}}
{\footnotesize\ttfamily void load\+\_\+configuration (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Load configuration from E\+E\+P\+R\+OM. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
read configuration from eeprom \mbox{\Hypertarget{i2c-th_8ino_a1c5769e114267b210fb3812064d01dd0}\label{i2c-th_8ino_a1c5769e114267b210fb3812064d01dd0}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!make\+\_\+observation\+\_\+from\+\_\+samples@{make\+\_\+observation\+\_\+from\+\_\+samples}}
\index{make\+\_\+observation\+\_\+from\+\_\+samples@{make\+\_\+observation\+\_\+from\+\_\+samples}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{make\+\_\+observation\+\_\+from\+\_\+samples()}{make\_observation\_from\_samples()}}
{\footnotesize\ttfamily bool make\+\_\+observation\+\_\+from\+\_\+samples (\begin{DoxyParamCaption}\item[{bool}]{is\+\_\+force\+\_\+processing,  }\item[{\hyperlink{structsample__t}{sample\+\_\+t} $\ast$}]{sample,  }\item[{\hyperlink{structobservation__t}{observation\+\_\+t} $\ast$}]{observation }\end{DoxyParamCaption})}



Processing the samples to calculate an observation when the number of the samples reaches the exact samples\+\_\+count value. 


\begin{DoxyParams}{Parameters}
{\em is\+\_\+force\+\_\+processing} & if is true, force the calculation of the observation provided there is a minimum number of samples. \\
\hline
{\em $\ast$sample} & input samples. \\
\hline
{\em $\ast$observation} & output observation. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
default value for observation

when true, indicates that sufficient samples have been acquired for the calculation of an observation (except for samples errors)

force processing when samples\+\_\+count = S\+E\+N\+S\+O\+R\+S\+\_\+\+S\+A\+M\+P\+L\+E\+\_\+\+C\+O\+U\+N\+T\+\_\+\+M\+AX

force processing when samples\+\_\+count = S\+E\+N\+S\+O\+R\+S\+\_\+\+S\+A\+M\+P\+L\+E\+\_\+\+C\+O\+U\+N\+T\+\_\+\+M\+IN

normal behavior\+: processing when correct measure sample count + error measure sample count == samples\+\_\+count

if true, indicates that there are good enough samples for the calculation of observation

if true, you can calculate the observation

sum all good samples

calculate average of all good samples

assign a observation buffer with current value \mbox{\Hypertarget{i2c-th_8ino_ab301e4d552826ef91458f52963949a1d}\label{i2c-th_8ino_ab301e4d552826ef91458f52963949a1d}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!make\+\_\+value\+\_\+from\+\_\+samples\+\_\+and\+\_\+observations@{make\+\_\+value\+\_\+from\+\_\+samples\+\_\+and\+\_\+observations}}
\index{make\+\_\+value\+\_\+from\+\_\+samples\+\_\+and\+\_\+observations@{make\+\_\+value\+\_\+from\+\_\+samples\+\_\+and\+\_\+observations}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{make\+\_\+value\+\_\+from\+\_\+samples\+\_\+and\+\_\+observations()}{make\_value\_from\_samples\_and\_observations()}}
{\footnotesize\ttfamily bool make\+\_\+value\+\_\+from\+\_\+samples\+\_\+and\+\_\+observations (\begin{DoxyParamCaption}\item[{\hyperlink{structsample__t}{sample\+\_\+t} $\ast$}]{sample,  }\item[{\hyperlink{structobservation__t}{observation\+\_\+t} $\ast$}]{observation,  }\item[{volatile \hyperlink{structvalue__t}{value\+\_\+t} $\ast$}]{value }\end{DoxyParamCaption})}



Processing the observations to calculate a value for report when the number of the observations reaches the minimum value of S\+T\+A\+T\+I\+S\+T\+I\+C\+A\+L\+\_\+\+D\+A\+T\+A\+\_\+\+C\+O\+U\+NT. 


\begin{DoxyParams}{Parameters}
{\em $\ast$sample} & input samples. \\
\hline
{\em $\ast$observation} & input observation. \\
\hline
{\em $\ast$value} & output value for report. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
new read pointer in circular observation buffer

temporary write pointer in circular observation buffer

temporary value

good observation counter

error observation counter

standard deviation

counter of the number of observation in memory

if true, you can calculate the value for report (there are at least S\+T\+A\+T\+I\+S\+T\+I\+C\+A\+L\+\_\+\+D\+A\+T\+A\+\_\+\+C\+O\+U\+NT observations)

initialize write ptr

calculate write\+\_\+ptr\+: if the end is reached, reset to the first address, else increment by one

reset value to default

loop until I have finished processing the last S\+T\+A\+T\+I\+S\+T\+I\+C\+A\+L\+\_\+\+D\+A\+T\+A\+\_\+\+C\+O\+U\+NT observations

if it is a good observation, calculate sum, minimum and maximum value. Otherwise increment error counter.

assign minimum to report value

assign maximum to report value

calculate read\+\_\+ptr\+: if the end is reached, reset to the first address, else increment by one

calculate next read\+\_\+ptr (observation-\/$>$write\+\_\+ptr + 1 for pre-\/calculate next processing)

assign read\+\_\+ptr to new next value

assign last sample to report value

assign last observation to report value

calculate observations average only if there are enough good observations

calculate standard deviation

loop until I have finished processing the last S\+T\+A\+T\+I\+S\+T\+I\+C\+A\+L\+\_\+\+D\+A\+T\+A\+\_\+\+C\+O\+U\+NT observations

if it is a good observation, calculate variance

calculate read\+\_\+ptr\+: if the end is reached, reset to the first address, else increment by one

calculate standard deviation only if there are enough good observations

calculate next read\+\_\+ptr (observation-\/$>$write\+\_\+ptr + 1 for pre-\/calculate next processing)

assign read\+\_\+ptr to new next value \mbox{\Hypertarget{i2c-th_8ino_a4c8e037e3b3f4c043abf3de8cf57fe68}\label{i2c-th_8ino_a4c8e037e3b3f4c043abf3de8cf57fe68}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!observations\+\_\+processing@{observations\+\_\+processing}}
\index{observations\+\_\+processing@{observations\+\_\+processing}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{observations\+\_\+processing()}{observations\_processing()}}
{\footnotesize\ttfamily void observations\+\_\+processing (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Main routine for processing the observations to calculate a value for report. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
if true, a new temperature report was calculated

if true, a new humidty report was calculated

reset buffer of samples value \mbox{\Hypertarget{i2c-th_8ino_a65b2dadc0411e43874ec8ed7f73bc62a}\label{i2c-th_8ino_a65b2dadc0411e43874ec8ed7f73bc62a}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!print\+\_\+configuration@{print\+\_\+configuration}}
\index{print\+\_\+configuration@{print\+\_\+configuration}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{print\+\_\+configuration()}{print\_configuration()}}
{\footnotesize\ttfamily void print\+\_\+configuration (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Print current configuration. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c-th_8ino_adfc6b4ac31f79cb1c99dd2409f05f32d}\label{i2c-th_8ino_adfc6b4ac31f79cb1c99dd2409f05f32d}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!reset\+\_\+observations\+\_\+buffer@{reset\+\_\+observations\+\_\+buffer}}
\index{reset\+\_\+observations\+\_\+buffer@{reset\+\_\+observations\+\_\+buffer}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{reset\+\_\+observations\+\_\+buffer()}{reset\_observations\_buffer()}}
{\footnotesize\ttfamily void reset\+\_\+observations\+\_\+buffer (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Reset observations buffers to default value. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c-th_8ino_ae176339df7451dc03037f319710575aa}\label{i2c-th_8ino_ae176339df7451dc03037f319710575aa}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!reset\+\_\+samples\+\_\+buffer@{reset\+\_\+samples\+\_\+buffer}}
\index{reset\+\_\+samples\+\_\+buffer@{reset\+\_\+samples\+\_\+buffer}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{reset\+\_\+samples\+\_\+buffer()}{reset\_samples\_buffer()}}
{\footnotesize\ttfamily void reset\+\_\+samples\+\_\+buffer (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Reset samples buffers to default value. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c-th_8ino_aba0fc91d6c2829df00a9d5fe2b921c90}\label{i2c-th_8ino_aba0fc91d6c2829df00a9d5fe2b921c90}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!samples\+\_\+processing@{samples\+\_\+processing}}
\index{samples\+\_\+processing@{samples\+\_\+processing}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{samples\+\_\+processing()}{samples\_processing()}}
{\footnotesize\ttfamily void samples\+\_\+processing (\begin{DoxyParamCaption}\item[{bool}]{is\+\_\+force\+\_\+processing }\end{DoxyParamCaption})}



Main routine for processing the samples to calculate an observation. 


\begin{DoxyParams}{Parameters}
{\em is\+\_\+force\+\_\+processing} & if is true, force the calculation of the observation provided there is a minimum number of samples. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
if true, a new temperature observation was calculated

if true, a new humidity observation was calculated

assign new value for samples\+\_\+count \mbox{\Hypertarget{i2c-th_8ino_afa979a8cb238fe81bf20654dfd6096ef}\label{i2c-th_8ino_afa979a8cb238fe81bf20654dfd6096ef}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!save\+\_\+configuration@{save\+\_\+configuration}}
\index{save\+\_\+configuration@{save\+\_\+configuration}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{save\+\_\+configuration()}{save\_configuration()}}
{\footnotesize\ttfamily void save\+\_\+configuration (\begin{DoxyParamCaption}\item[{bool}]{is\+\_\+default }\end{DoxyParamCaption})}



Save configuration to E\+E\+P\+R\+OM. 


\begin{DoxyParams}{Parameters}
{\em is\+\_\+default} & if true save default configuration; if false save current configuration. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
write configuration to eeprom \mbox{\Hypertarget{i2c-th_8ino_ad3efe51e17cb8205a24267c2992a12d4}\label{i2c-th_8ino_ad3efe51e17cb8205a24267c2992a12d4}} 
\index{i2c-\/th.\+ino@{i2c-\/th.\+ino}!sensors\+\_\+reading\+\_\+task@{sensors\+\_\+reading\+\_\+task}}
\index{sensors\+\_\+reading\+\_\+task@{sensors\+\_\+reading\+\_\+task}!i2c-\/th.\+ino@{i2c-\/th.\+ino}}
\subsubsection{\texorpdfstring{sensors\+\_\+reading\+\_\+task()}{sensors\_reading\_task()}}
{\footnotesize\ttfamily void sensors\+\_\+reading\+\_\+task (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Sensors reading Task. Read data from sensors. 

\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}
reset internal state of all sensors to default

prepare sensor and get delay for complete operation

if there is any delay, wait it. Otherwise go to next.

success

retry

fail

get V\+A\+L\+U\+E\+S\+\_\+\+T\+O\+\_\+\+R\+E\+A\+D\+\_\+\+F\+R\+O\+M\+\_\+\+S\+E\+N\+S\+O\+R\+\_\+\+C\+O\+U\+NT values from sensor and store it in values\+\_\+readed\+\_\+from\+\_\+sensor.

end of internal sensor state (finished read)

success

retry

fail

mark error

go to next sensor

process other internal sensor state

read sensor value

go to next sensor

end (there are no other sensors to read)

if it is in continuous mode, do samples processing 